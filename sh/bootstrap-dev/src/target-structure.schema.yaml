---
# Target Structure Schema
# Defines the expected directory structure after AI Guardrails installation
schema_version: "1.2.0"
name: "ai-guardrails-target-structure"

# Expected directory structure in target project
expected_structure:
  # Core AI configuration directory
  ".ai/":
    required: true
    description: "Core AI guardrails configuration directory"
    subdirs:
      "schemas/":
        required: true
        description: "JSON schemas for validation"
        files:
          "copilot_envelope.schema.json":
            required: true
            description: "Copilot envelope JSON schema"
      "scripts/":
        required: false
        description: "Automation scripts"
        subdirs:
          "policy/":
            required: false
            description: "Policy scripts"
        file_patterns:
          - "*.py"
          - "*.sh"
      "guardrails/":
        required: false
        description: "Extended guardrails configuration"
        files:
          "root-allowlist.txt":
            required: false
            description: "Files allowed in repository root"
    files:
      "guardrails.yaml":
        required: true
        description: "Language-specific lint/test commands"
        schema_ref: "guardrails.schema.yaml"
      "envelope.json":
        required: false
        description: "Copilot planning envelope (auto-generated)"
        schema_ref: ".ai/schemas/copilot_envelope.schema.json"
      "capabilities.md":
        required: false
        description: "AI capabilities documentation"

  # GitHub integration (optional)
  ".github/":
    required: false
    description: "GitHub-specific automation"
    subdirs:
      "workflows/":
        required: false
        description: "GitHub Actions workflows"
        files:
          "ai_guardrails_on_commit.yaml":
            required: false
            description: "AI guardrails validation workflow"
          "copilot_guard.yaml":
            required: false
            description: "Copilot guard validation workflow"
      "instructions/":
        required: false
        description: "AI instruction files"
      "chatmodes/":
        required: false
        description: "GitHub Copilot chat modes"
      "prompts/":
        required: false
        description: "AI prompt templates"
    files:
      "pull_request_template.md":
        required: false
        description: "Pull request template"

  # Documentation (optional)
  "docs/":
    required: false
    description: "Project documentation"
    subdirs:
      "decisions/":
        required: false
        description: "Architecture Decision Records"
      "guides/":
        required: false
        description: "User and developer guides"
      "coe/":
        required: false
        description: "Correction of Error documents"
      "sprints/":
        required: false
        description: "Sprint planning documents"

  # Pre-commit configuration (optional)
  ".pre-commit-config.yaml":
    required: false
    description: "Pre-commit hooks configuration"

  # Git hooks infrastructure (optional)
  ".githooks/":
    required: false
    description: "Modular git hooks system"
    subdirs:
      "pre-commit.d/":
        required: false
        description: "Pre-commit hook scripts"
      "commit-msg.d/":
        required: false
        description: "Commit message hook scripts"
    files:
      "_run_hook":
        required: false
        description: "Modular hook runner script"
      "pre-commit":
        required: false
        description: "Pre-commit hook (symlink to _run_hook)"
      "commit-msg":
        required: false
        description: "Commit message hook (symlink to _run_hook)"

# Validation rules
validation:
  # Core requirements that must be satisfied
  core_requirements:
    - "Must have .ai/ directory with guardrails.yaml"
    - "Must have .ai/schemas/ directory with copilot_envelope.schema.json"
    - "No files allowed in repository root unless in root-allowlist.txt"

  # Structure constraints
  constraints:
    - name: "ai_directory_structure"
      description: "AI directories must follow standard layout"
      rule: ".ai/ for all AI-related configuration, schemas, and automation"

    - name: "schema_validation"
      description: "All JSON files must validate against their schemas"
      rule: "Files with .json extension must pass schema validation"

    - name: "naming_conventions"
      description: "Files must follow naming conventions"
      rule: "ADR files use ADR-NNN-title.md format"

  # Conflict resolution
  conflicts:
    - pattern: ".ai/guardrails.yaml vs .ai/guardrails/"
      resolution: "Both can coexist - file for simple config, directory for complex"

    - pattern: "docs/ vs .github/ documentation"
      resolution: "docs/ for project docs, .github/ for GitHub-specific automation"

# Profile-specific extensions
profiles:
  minimal:
    required_structure:
      - ".ai/guardrails.yaml"
      - ".ai/schemas/copilot_envelope.schema.json"

  standard:
    required_structure:
      - ".ai/guardrails.yaml"
      - ".ai/schemas/copilot_envelope.schema.json"
      - ".ai/scripts/"
      - ".ai/scripts/policy/"
      - ".githooks/"
      - ".github/chatmodes/"
      - ".github/instructions/"
      - "docs/"
      - ".pre-commit-config.yaml"

  full:
    required_structure:
      - ".ai/guardrails.yaml"
      - ".ai/schemas/copilot_envelope.schema.json"
      - ".ai/scripts/"
      - ".ai/scripts/policy/"
      - ".githooks/"
      - ".github/chatmodes/"
      - ".github/instructions/"
      - ".github/workflows/"
      - "docs/"
      - ".pre-commit-config.yaml"

# Evolution tracking
version_history:
  "1.2.0":
    changes:
      - "Added .githooks/ directory for modular git hooks system"
      - "Updated standard and full profiles to include .githooks/"
      - "Defined githooks subdirectory structure (.d/ directories for hooks)"
      - "Added core git hook files (_run_hook, pre-commit, commit-msg, post-commit)"
  "1.1.0":
    changes:
      - "Consolidated all AI-related files under .ai/ directory"
      - "Moved schemas from ai/schemas/ to .ai/schemas/"
      - "Moved scripts from ai/scripts/ to .ai/scripts/"
      - "Removed separate ai/ directory structure"
      - "Updated validation rules to reflect single .ai/ structure"
  "1.0.0":
    changes:
      - "Initial target structure schema definition"
      - "Separated .ai/ (config) from ai/ (automation)"
      - "Defined core vs optional components"
