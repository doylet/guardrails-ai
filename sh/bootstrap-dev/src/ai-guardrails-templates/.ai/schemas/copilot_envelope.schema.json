{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Copilot JSON Envelope",
  "type": "object",
  "required": ["discovery","plan","changes","tests","validation","limits","risks","rollback","status"],
  "properties": {
    "discovery": {"type":"array","minItems":1,"items":{"type":"object","required":["path","why"],"properties":{"path":{"type":"string"},"evidence":{"type":"string"},"why":{"type":"string"}},"additionalProperties":false}},
    "assumptions":{"type":"array","items":{"type":"string"}},
    "plan":{"type":"array","minItems":1,"items":{"type":"string"}},
    "changes":{"type":"array","items":{"type":"object","required":["path","patch"],"properties":{"path":{"type":"string"},"patch":{"type":"string"}},"additionalProperties":false}},
    "tests":{"type":"array","items":{"type":"object","properties":{"path":{"type":"string"},"patch":{"type":"string"},"golden":{"type":"string"},"check":{"type":"string","enum":["structural","byte","custom"]}},"additionalProperties":false}},
    "validation":{"type":"object","required":["commands"],"properties":{"commands":{"type":"array","items":{"type":"string"}},"results":{"type":"array","items":{"type":"string"}}},"additionalProperties":true},
    "limits":{"type":"object","required":["files_touched","workflow"],"properties":{"files_touched":{"type":"integer","minimum":1},"workflow":{"type":"string","enum":["Loop","Debug","Express","Main"]}},"additionalProperties":false},
    "risks":{"type":"array","items":{"type":"string"}},
    "rollback":{"type":"array","items":{"type":"string"}},
    "question":{"type":["string","null"]},
    "status":{"type":"string","enum":["READY_FOR_REVIEW","BLOCKED","DRAFT"]},
    "could_not_find":{"type":"array","items":{"type":"string"}}
  },
  "additionalProperties": false
}
